# CoinMetric

Android-приложение для семейного планирования бюджета с локальной БД и базовой синхронизацией через Google-аккаунт.

## Что уже сделано

### Базовые функции
- Реализована локальная база данных на Room:
  - категории,
  - участники семьи,
  - транзакции,
  - лимиты по категориям,
  - постоянные платежи.
- Добавлен семейный сценарий использования: хранение и отображение участников с Google email.
- Реализованы категории расходов и месячные лимиты с отображением прогресса в дашборде.
- Добавлены постоянные платежи.
- Добавлено создание транзакций с мини-калькулятором выражений (например, `1200+350/2`).
- В дашборд добавлены регулярные отчёты за неделю и месяц: доходы, расходы, топ-категория и динамика к прошлому периоду.

### Просмотр и аналитика
- Реализован календарный просмотр операций по дням.
- Реализован аналитический дэшборд:
  - доходы,
  - расходы,
  - баланс,
  - расходы по категориям.

### Инфраструктура
- Подключён WorkManager-воркер для периодической синхронизации (пока заглушка).
- Добавлена интеграция с Google Sign-In для определения аккаунта на устройстве.


### Что реализовано по синхронизации
- Модель Firestore теперь включает:
  - коллекции доменных сущностей (`categories`, `members`, `transactions`, `recurring`, `invites`, `limits`),
  - коллекцию `changes` для change log с типом сущности, id, действием и timestamp.
- Локально добавлены таблицы:
  - `SyncChangeLog` — журнал локальных/удалённых изменений,
  - `SyncState` — курсоры `lastPulledAtEpochMillis` и `lastPushedAtEpochMillis`.
- WorkManager-воркер выполняет двусторонний инкрементальный sync:
  1. pull только изменённых записей с Firestore с момента последнего pull,
  2. merge в локальную БД с conflict resolution (last write wins),
  3. push только локальных изменений с момента последнего push,
  4. обновление курсоров синхронизации.

## Технологический стек
- Kotlin + Jetpack Compose
- Room
- WorkManager
- Google Sign-In

## План следующих действий

### 1) Синхронизация данных
- [x] Спроектировать серверную/облачную модель (Firestore) с коллекциями сущностей и журналом изменений.
- [x] Реализовать двустороннюю синхронизацию с разрешением конфликтов по `updatedAtEpochMillis` (LWW).
- [x] Добавить журнал изменений (change log) и инкрементальные обновления через курсоры pull/push.

### 2) Совместная работа семьи
- [x] Добавить базовые приглашения участников в семейный бюджет по email (валидация, выбор роли, список приглашений в UI).
- [ ] Расширить приглашения по ссылке и жизненный цикл принятия/отклонения.
- [ ] Разграничить роли (владелец, редактор, просмотр).
- [ ] Логировать действия участников (кто и что изменил).

### 3) Контроль бюджета
- [x] Реализовать полноценные лимиты по категориям на месяц.
- [x] Добавить push/локальные уведомления о приближении и превышении лимитов.
- [x] Добавить регулярные отчёты (неделя/месяц) по расходам.

### 4) UX и стабильность
- [x] Улучшить пустые состояния для ключевых экранов (дашборд, транзакции, календарь, семья, платежи).
- [x] Добавить onboarding и подсказки для первого запуска.
- [x] Добавить офлайн-first обработку ошибок синхронизации.
- [ ] Покрыть ключевые сценарии тестами (unit + UI) и настроить CI-проверки.

### 5) Улучшение дизайна (UI refresh)
- [x] Составить план визуального обновления экранов (иерархия, отступы, карточки, единая типографика).
- [x] Внедрить базовый слой нового UI: AppBar, единые секции-карточки, улучшенные блоки сводки и отчётов.
- [x] Привести формы ввода к единому стилю (ширина полей, группировка действий, читаемые состояния пустых списков).
- [x] Добавить адаптивные размеры/брейкпоинты для планшетов и landscape-режима.
- [x] Добавить дизайн-токены (цвета/скругления/типографика) через выделенную тему Compose.

## Реализация плана по дизайну (что уже внедрено)

- Экран получил новый визуальный каркас: верхний `TopAppBar` + вкладки для стабильной навигации.
- Введён единый компонент `SectionCard` для консистентного отображения блоков на всех вкладках.
- Улучшено представление сводки бюджета, лимитов, отчётов и аналитики через переиспользуемые строки `SummaryRow`.
- Формы на вкладках «Транзакции», «Семья» и «Платежи» унифицированы: поля ввода на всю ширину, действия логически сгруппированы.
- Пустые состояния визуально выровнены через карточку с `surfaceVariant`, чтобы акцентировать подсказки и onboarding-поток без перегруза интерфейса.

- Добавлен onboarding-блок «Быстрый старт» на главном экране с ключевыми шагами первого запуска и действием скрытия подсказок.
- В настройки добавлен переключатель показа onboarding-подсказок, чтобы пользователь мог заново включить их при необходимости.

- Добавлены адаптивные брейкпоинты контейнера контента (`AdaptiveScreenContainer`): контент центрируется и ограничивается по ширине на больших экранах, вкладки переведены в `ScrollableTabRow` для стабильной работы в portrait/landscape.
- Введена выделенная тема `CoinMetricTheme` с дизайн-токенами (цвета и скругления) и подключена в `MainActivity` как единая точка стилизации приложения.
- Добавлена офлайн-first обработка ошибок синхронизации в настройках: отображаются статус синхронизации, очередь локальных изменений и кнопка повторной отправки после восстановления сети.
- В настройках реализован рабочий сценарий приглашения участника: ввод email, выбор роли (просмотр/редактор), валидация и список отправленных приглашений.
